--[[ 
    OffenseWare Mobile | Arsenal "Version" V1.0
    - ESP Update: Skeleton, Tracers, Chams, Boxes
    - Aimbot: Legit & Blatant Modes
    - Performance: Optimized for Mobile Executors
]]

-- Debug Start
print("OffenseWare: Loading V1.0...")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // 1. LIBRARY LADEN //
local success, Library = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/OffenseWare-OF/OffenseWare-lib/main/OffenseWare.lua"))()
end)

if not success or not Library then
    -- Fallback Notification
    game.StarterGui:SetCore("SendNotification", {Title = "OffenseWare Error"; Text = "Lib failed to load!"; Duration = 5;})
    return
end

local Window = Library:CreateWindow("OffenseWare | V1.0")

local CombatTab = Window:CreateTab("Combat")
local VisualTab = Window:CreateTab("Visuals")
local GunTab = Window:CreateTab("Gun Mods")
local MoveTab = Window:CreateTab("Movement")
local SettingsTab = Window:CreateTab("Settings")

-- // CONFIGURATION //
local Config = {
    Aimbot = {
        Enabled = false,
        FOV = 120,
        Smoothing = 0.5,
        WallCheck = true,
        Part = "Head"
    },
    ESP = {
        Enabled = false,
        Boxes = true,
        Names = false,
        Health = false,
        Distance = false,
        Chams = false,
        Skeletons = false,
        Tracers = false
    },
    Gun = {
        InfAmmo = false,
        FastFire = false,
        NoRecoil = false
    },
    Fly = {
        Enabled = false,
        Speed = 50
    }
}

-- // UTILS //
local function IsEnemy(plr)
    if not plr or not plr.Team then return true end -- FFA support
    return plr.Team ~= LocalPlayer.Team
end

local ESP_Storage = {}

-- Helper f체r Drawings
local function CreateLine()
    local line = Drawing.new("Line")
    line.Thickness = 1.5
    line.Color = Color3.new(1, 1, 1)
    line.Transparency = 1
    line.Visible = false
    return line
end

local function CreateESP(plr)
    if ESP_Storage[plr] then return end
    
    -- 1. Billboard GUI (Performance: Box, Name, Health, Distance)
    local BGui = Instance.new("BillboardGui")
    BGui.Name = "OW_ESP"
    BGui.AlwaysOnTop = true
    BGui.Size = UDim2.new(4, 0, 5.5, 0)
    
    local Frame = Instance.new("Frame", BGui)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundTransparency = 1
    
    local Stroke = Instance.new("UIStroke", Frame)
    Stroke.Color = Color3.fromRGB(255, 0, 0)
    Stroke.Thickness = 1.5
    
    local Info = Instance.new("TextLabel", Frame) -- Name & Dist
    Info.Size = UDim2.new(1, 0, 0, 20)
    Info.Position = UDim2.new(0, 0, -0.25, 0)
    Info.BackgroundTransparency = 1
    Info.TextColor3 = Color3.new(1, 1, 1)
    Info.Font = Enum.Font.GothamBold
    Info.TextSize = 11
    Info.TextStrokeTransparency = 0
    
    local HBarBG = Instance.new("Frame", Frame) -- Health Bar BG
    HBarBG.Size = UDim2.new(0.05, 0, 1, 0)
    HBarBG.Position = UDim2.new(-0.15, 0, 0, 0)
    HBarBG.BackgroundColor3 = Color3.new(0, 0, 0)
    HBarBG.BorderSizePixel = 0
    
    local HBarFill = Instance.new("Frame", HBarBG) -- Health Fill
    HBarFill.Size = UDim2.new(1, 0, 1, 0)
    HBarFill.BackgroundColor3 = Color3.new(0, 1, 0)
    HBarFill.BorderSizePixel = 0

    -- 2. Drawings (Precision: Skeleton, Tracers)
    local Tracer = CreateLine()
    local Skeleton = {
        Head_Torso = CreateLine(),
        Torso_LArm = CreateLine(),
        Torso_RArm = CreateLine(),
        Torso_LLeg = CreateLine(),
        Torso_RLeg = CreateLine()
    }

    ESP_Storage[plr] = {
        Gui = BGui,
        Stroke = Stroke,
        Info = Info,
        HBarBG = HBarBG,
        HBarFill = HBarFill,
        Tracer = Tracer,
        Skeleton = Skeleton,
        Highlight = nil
    }
end

local function RemoveESP(plr)
    local obj = ESP_Storage[plr]
    if obj then
        if obj.Gui then obj.Gui:Destroy() end
        if obj.Tracer then obj.Tracer:Remove() end
        for _, line in pairs(obj.Skeleton) do line:Remove() end
        if obj.Highlight then obj.Highlight:Destroy() end
        ESP_Storage[plr] = nil
    end
end

local function UpdateESP()
    for plr, obj in pairs(ESP_Storage) do
        -- Validit채tspr체fung
        if not plr.Parent or not plr.Character or not Config.ESP.Enabled or not IsEnemy(plr) then
            obj.Gui.Parent = nil
            obj.Tracer.Visible = false
            for _, line in pairs(obj.Skeleton) do line.Visible = false end
            if obj.Highlight then obj.Highlight.Enabled = false end
        else
            local char = plr.Character
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local head = char:FindFirstChild("Head")
            local hum = char:FindFirstChild("Humanoid")
            
            if hrp and head and hum and hum.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                
                -- A. BILLBOARD UPDATES (Box/Name/Health)
                obj.Gui.Parent = game.CoreGui
                obj.Gui.Adornee = hrp
                
                -- Toggle Checks
                obj.Stroke.Enabled = Config.ESP.Boxes
                
                local infoText = ""
                if Config.ESP.Names then infoText = plr.Name end
                if Config.ESP.Distance then 
                    infoText = infoText .. " [" .. math.floor((hrp.Position - Camera.CFrame.Position).Magnitude) .. "m]" 
                end
                obj.Info.Text = infoText
                
                if Config.ESP.Health then
                    obj.HBarBG.Visible = true
                    local hp = math.clamp(hum.Health / hum.MaxHealth, 0, 1)
                    obj.HBarFill.Size = UDim2.new(1, 0, hp, 0)
                    obj.HBarFill.Position = UDim2.new(0, 0, 1 - hp, 0)
                    obj.HBarFill.BackgroundColor3 = Color3.fromHSV(hp * 0.3, 1, 1) -- Gr체n zu Rot
                else
                    obj.HBarBG.Visible = false
                end
                
                -- B. CHAMS (Highlight)
                if Config.ESP.Chams then
                    if not obj.Highlight then
                        obj.Highlight = Instance.new("Highlight", char)
                        obj.Highlight.FillColor = Color3.fromRGB(255, 0, 0)
                        obj.Highlight.OutlineColor = Color3.new(1,1,1)
                        obj.Highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    end
                    obj.Highlight.Enabled = true
                elseif obj.Highlight then
                    obj.Highlight.Enabled = false
                end

                -- C. DRAWINGS (Tracer & Skeleton)
                if onScreen then
                    -- Tracer
                    if Config.ESP.Tracers then
                        obj.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y) -- Bottom Middle
                        obj.Tracer.To = Vector2.new(pos.X, pos.Y)
                        obj.Tracer.Visible = true
                    else
                        obj.Tracer.Visible = false
                    end
                    
                    -- Skeleton (Exunys Style)
                    if Config.ESP.Skeletons then
                        local function WTSP(part) -- World To Screen Point
                            local p = Camera:WorldToViewportPoint(part.Position)
                            return Vector2.new(p.X, p.Y)
                        end
                        
                        -- Teile finden
                        local torso = char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso")
                        local lArm = char:FindFirstChild("LeftUpperArm") or char:FindFirstChild("Left Arm")
                        local rArm = char:FindFirstChild("RightUpperArm") or char:FindFirstChild("Right Arm")
                        local lLeg = char:FindFirstChild("LeftUpperLeg") or char:FindFirstChild("Left Leg")
                        local rLeg = char:FindFirstChild("RightUpperLeg") or char:FindFirstChild("Right Leg")
                        
                        if torso and lArm and rArm and lLeg and rLeg then
                            local headP = WTSP(head)
                            local torsoP = WTSP(torso)
                            
                            -- Head to Torso
                            obj.Skeleton.Head_Torso.From = headP; obj.Skeleton.Head_Torso.To = torsoP; obj.Skeleton.Head_Torso.Visible = true
                            -- Arms
                            obj.Skeleton.Torso_LArm.From = torsoP; obj.Skeleton.Torso_LArm.To = WTSP(lArm); obj.Skeleton.Torso_LArm.Visible = true
                            obj.Skeleton.Torso_RArm.From = torsoP; obj.Skeleton.Torso_RArm.To = WTSP(rArm); obj.Skeleton.Torso_RArm.Visible = true
                            -- Legs
                            obj.Skeleton.Torso_LLeg.From = torsoP; obj.Skeleton.Torso_LLeg.To = WTSP(lLeg); obj.Skeleton.Torso_LLeg.Visible = true
                            obj.Skeleton.Torso_RLeg.From = torsoP; obj.Skeleton.Torso_RLeg.To = WTSP(rLeg); obj.Skeleton.Torso_RLeg.Visible = true
                        else
                             for _, l in pairs(obj.Skeleton) do l.Visible = false end
                        end
                    else
                        for _, l in pairs(obj.Skeleton) do l.Visible = false end
                    end
                else
                    -- Offscreen
                    obj.Tracer.Visible = false
                    for _, l in pairs(obj.Skeleton) do l.Visible = false end
                end
            else
                -- Tot oder kein Character
                obj.Gui.Parent = nil
                obj.Tracer.Visible = false
                for _, l in pairs(obj.Skeleton) do l.Visible = false end
            end
        end
    end
end

RunService.RenderStepped:Connect(UpdateESP)
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
for _, p in pairs(Players:GetPlayers()) do if p ~= LocalPlayer then CreateESP(p) end end

-- // AIMBOT LOGIC (LEGIT/BLATANT) //
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = false
FOVCircle.Color = Color3.fromRGB(170, 60, 255)
FOVCircle.Thickness = 1.5
FOVCircle.NumSides = 24
FOVCircle.Filled = false

local function IsVisible(targetPart)
    if not Config.Aimbot.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = targetPart.Position - origin
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    params.IgnoreWater = true
    local result = Workspace:Raycast(origin, direction, params)
    return not result or result.Instance:IsDescendantOf(targetPart.Parent)
end

local function GetClosestTarget()
    local closest, shortest = nil, math.huge
    local mouse = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and IsEnemy(v) and v.Character then
            local part = v.Character:FindFirstChild(Config.Aimbot.Part)
            local hum = v.Character:FindFirstChild("Humanoid")
            if part and hum and hum.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - mouse).Magnitude
                    if dist < shortest and dist <= Config.Aimbot.FOV then
                        if IsVisible(part) then
                            closest = part
                            shortest = dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Radius = Config.Aimbot.FOV
    FOVCircle.Visible = Config.Aimbot.Enabled

    if Config.Aimbot.Enabled then
        local target = GetClosestTarget()
        if target then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, target.Position), Config.Aimbot.Smoothing)
        end
    end
end)

-- // GUN MODS //
task.spawn(function()
    local RS = game:GetService("ReplicatedStorage")
    local wkspc = RS:WaitForChild("wkspc", 10)
    local Weapons = RS:WaitForChild("Weapons", 10)
    
    while task.wait(1.5) do
        if Config.Gun.InfAmmo or Config.Gun.FastFire or Config.Gun.NoRecoil then
            pcall(function()
                if Config.Gun.InfAmmo and wkspc and wkspc:FindFirstChild("CurrentCurse") then
                    if wkspc.CurrentCurse.Value ~= "Infinite Ammo" then wkspc.CurrentCurse.Value = "Infinite Ammo" end
                end
                if Weapons then
                    for _, v in ipairs(Weapons:GetChildren()) do
                        if Config.Gun.FastFire then
                            local fr = v:FindFirstChild("FireRate"); if fr and fr.Value > 0.04 then fr.Value = 0.04 end
                            local auto = v:FindFirstChild("Auto"); if auto then auto.Value = true end
                        end
                        if Config.Gun.NoRecoil then
                            local rc = v:FindFirstChild("RecoilControl"); if rc and rc.Value ~= 0 then rc.Value = 0 end
                            local sp = v:FindFirstChild("Spread"); if sp and sp.Value ~= 0 then sp.Value = 0 end
                        end
                    end
                end
            end)
        end
    end
end)

-- // JOYSTICK FLY //
local flyBV, flyBG
local function ToggleFly(state)
    if state then
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
        local hrp = LocalPlayer.Character.HumanoidRootPart
        flyBV = Instance.new("BodyVelocity", hrp); flyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
        flyBG = Instance.new("BodyGyro", hrp); flyBG.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
        LocalPlayer.Character.Humanoid.PlatformStand = true
    else
        if flyBV then flyBV:Destroy() end; if flyBG then flyBG:Destroy() end
        if LocalPlayer.Character then LocalPlayer.Character.Humanoid.PlatformStand = false end
    end
end
RunService.Heartbeat:Connect(function()
    if Config.Fly.Enabled and flyBV then
        local cam = workspace.CurrentCamera
        local move = LocalPlayer.Character.Humanoid.MoveDirection
        local flyDir = (cam.CFrame.LookVector * move.Z * -1) + (cam.CFrame.RightVector * move.X)
        flyBV.Velocity = move.Magnitude == 0 and Vector3.zero or flyDir * Config.Fly.Speed
        flyBG.CFrame = cam.CFrame
    end
end)

-- // UI SETUP //
CombatTab:Section("Aimbot")
CombatTab:CreateToggle("Enable Aimbot", false, function(v) Config.Aimbot.Enabled = v end)
CombatTab:CreateToggle("Wall Check", true, function(v) Config.Aimbot.WallCheck = v end)
CombatTab:CreateSlider("FOV Radius", 10, 500, 120, function(v) Config.Aimbot.FOV = v end)
CombatTab:CreateSlider("Smoothing", 1, 100, 50, function(v) Config.Aimbot.Smoothing = v/100 end)

VisualTab:Section("ESP Settings")
VisualTab:CreateToggle("Master Switch", false, function(v) Config.ESP.Enabled = v end)
VisualTab:CreateToggle("Show Boxes", true, function(v) Config.ESP.Boxes = v end)
VisualTab:CreateToggle("Show Names", false, function(v) Config.ESP.Names = v end)
VisualTab:CreateToggle("Show Health", false, function(v) Config.ESP.Health = v end)
VisualTab:CreateToggle("Show Distance", false, function(v) Config.ESP.Distance = v end)
VisualTab:CreateToggle("Tracers", false, function(v) Config.ESP.Tracers = v end)
VisualTab:CreateToggle("Skeletons (Beta)", false, function(v) Config.ESP.Skeletons = v end)
VisualTab:CreateToggle("Chams (Red)", false, function(v) Config.ESP.Chams = v end)

GunTab:Section("Blatant")
GunTab:CreateToggle("Infinite Ammo", false, function(v) Config.Gun.InfAmmo = v end)
GunTab:CreateToggle("Fast Fire", false, function(v) Config.Gun.FastFire = v end)
GunTab:CreateToggle("No Recoil", false, function(v) Config.Gun.NoRecoil = v end)

MoveTab:Section("Movement")
MoveTab:CreateToggle("Joystick Fly", false, function(v) Config.Fly.Enabled = v; ToggleFly(v) end)
MoveTab:CreateSlider("Speed", 10, 200, 50, function(v) Config.Fly.Speed = v end)

SettingsTab:Section("Config")
SettingsTab:CreateButton("Unload Script", function()
    Config.Aimbot.Enabled = false; Config.ESP.Enabled = false; Config.Gun.InfAmmo = false; ToggleFly(false)
    FOVCircle:Remove()
    for _, v in pairs(ESP_Storage) do RemoveESP(v) end
    game.CoreGui:FindFirstChild("OffenseWareLib"):Destroy()
end)

Library:Notify("OffenseWare", "V1.0 Loaded Successfully!", 3)
